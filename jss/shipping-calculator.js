if(!customElements.get("shipping-calculator")){class ShippingCalculator extends HTMLElement{constructor(){super(),this.button=this.querySelector("button"),this.button.addEventListener("click",this.handleSubmit.bind(this))}init(){this.country=this.querySelector(".js-country-select"),this.province=this.querySelector(".js-province-select"),this.address="Abc, 123",this.zip=this.querySelector(".js-zip-input"),this.rates=this.querySelector(".js-rates"),this.errors=this.querySelector(".js-errors"),this.initialised=!0}async handleSubmit(evt){evt.preventDefault(),this.initialised||this.init(),this.errors.hidden=!0,this.rates.hidden=!0,this.button.disabled=!0,this.button.querySelector(".loading__spinner").classList.remove("hidden"),this.button.querySelector(".button-text").classList.add("hidden");const params=`shipping_address[zip]=${this.zip.value}&shipping_address[address1]=${this.address}&shipping_address[country]=${this.country.value}&shipping_address[province]=${this.province.value}`,paramsWithoutAddress=`shipping_address[zip]=${this.zip.value}&shipping_address[country]=${this.country.value}&shipping_address[province]=${this.province.value}`;try{const response=await fetch(`${theme.routes.cart}/shipping_rates.json?${params}`),data=await response.json();response.ok?(this.showRates(data),await fetch(`${theme.routes.cart}/shipping_rates.json?${paramsWithoutAddress}`)):this.showErrors(data)}catch(error){console.log(error)}finally{this.button.querySelector(".loading__spinner").classList.add("hidden"),this.button.querySelector(".button-text").classList.remove("hidden"),this.button.disabled=!1}}showRates(data){const headingEl=this.rates.querySelector(".js-rates-heading"),textEl=this.rates.querySelector(".js-rates-text");textEl.innerHTML="";const finalValue=document.querySelector("#CartDrawer .drawer__inner .drawer__footer .totals__subtotal-value")?.textContent.replace("R$","").replace(",",".").trim(),shippingValuesArray=data.shipping_rates.map(item=>+item.price),indexMinValue=shippingValuesArray.indexOf(Math.min(...shippingValuesArray));if(data.shipping_rates&&data.shipping_rates.length){const headingLocaleStr=data.shipping_rates.length===1?"singleRate":"multipleRates";let rates="";data.shipping_rates.forEach((rate,index)=>{if(rate.name?.includes("Stanley"))return;const deliveryDays=`Entrega em ${rate.delivery_days[0]} dia(s) \xFAtil(eis)`;let formattedRate=rate.currency==="BRL"?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(rate.price):theme.settings.moneyWithCurrencyFormat.replace(/\{\{\s*(\w+)\s*\}\}/,rate.price);(rate.price==="0.00"||+finalValue>350&&index===indexMinValue)&&(formattedRate=`<span style="color: #A30817; font-weight: 600;">${theme.strings.shippingCalculator.freeShipping}</span>`),rates+=`<li><p>${rate.name}: ${formattedRate}</p><p>${deliveryDays}</p></li>`}),headingEl.hidden=!1,headingEl.textContent=theme.strings.shippingCalculator[headingLocaleStr],textEl.innerHTML=`<ul class="styled-list">${rates}</ul>`}else headingEl.hidden=!0,textEl.innerHTML=theme.strings.shippingCalculator.noRates;this.rates.hidden=!1}showErrors(data){let errors="";Object.keys(data).forEach(key=>{errors+=`<li>${data[key]}</li>`}),this.errors.querySelector(".js-errors-text").innerHTML=`<ul class="styled-list">${errors}</ul>`,this.errors.hidden=!1}}customElements.define("shipping-calculator",ShippingCalculator)}
//# sourceMappingURL=/cdn/shop/t/13/assets/shipping-calculator.js.map?v=145308400164811722461724436472
